<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ariel Fontes - AI Chat</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(rgba(102, 126, 234, 0.6), rgba(118, 75, 162, 0.6)), 
                        url('me/minha_namorada.jpeg');
            background-size: 180% auto;
            background-position: left center;
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .language-selector {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .language-modal {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .language-modal h2 {
            margin-bottom: 20px;
            color: #667eea;
        }
        
        .language-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .language-btn {
            padding: 15px 25px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .language-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .chat-container {
            width: 100%;
            max-width: 700px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        
        .profile-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .profile-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid white;
            object-fit: cover;
        }
        
        .profile-info {
            text-align: left;
        }
        
        .profile-info h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .profile-info p {
            opacity: 0.9;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .company-logos {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .company-logo {
            height: 30px;
            filter: brightness(0) invert(1);
            opacity: 0.8;
            max-width: 100%;
            width: auto;
        }
        
        .chat-messages {
            height: 450px;
            overflow-y: auto;
            padding: 20px;
            background: rgba(248, 249, 250, 0.8);
        }
        
        .message {
            margin-bottom: 15px;
            padding: 15px 20px;
            border-radius: 18px;
            max-width: 85%;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease-in;
            line-height: 1.5;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-left: auto;
            text-align: right;
        }
        
        .bot-message {
            background: white;
            color: #333;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .bot-message h1, .bot-message h2, .bot-message h3 {
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .bot-message p {
            margin-bottom: 8px;
        }
        
        .bot-message ul, .bot-message ol {
            margin-left: 20px;
            margin-bottom: 8px;
        }
        
        .bot-message strong {
            color: #764ba2;
        }
        
        .bot-message em {
            color: #667eea;
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        
        .chat-input {
            display: flex;
            padding: 20px;
            background: white;
            border-top: 1px solid #e9ecef;
        }
        
        .chat-input input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .chat-input input:focus {
            border-color: #667eea;
        }
        
        .chat-input button {
            margin-left: 10px;
            padding: 12px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s;
        }
        
        .chat-input button:hover {
            transform: translateY(-2px);
        }
        
        .chat-input button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .typing-indicator {
            display: none;
            padding: 12px 18px;
            background: white;
            border-radius: 18px;
            color: #666;
            font-style: italic;
            margin-bottom: 15px;
        }
        
        .clear-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .clear-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* Custom scrollbar */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
            border-radius: 3px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 3px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        /* Responsive Design for Mobile */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .chat-container {
                max-width: 100%;
                border-radius: 15px;
            }
            
            .chat-header {
                padding: 20px 15px;
            }
            
            .profile-section {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .profile-photo {
                width: 60px;
                height: 60px;
            }
            
            .profile-info h1 {
                font-size: 20px;
            }
            
            .profile-info p {
                font-size: 14px;
            }
            
            .company-logo {
                width: 40px;
                height: 40px;
            }
            
            .chat-messages {
                max-height: 50vh;
                padding: 15px;
            }
            
            .message {
                padding: 12px 15px;
                margin-bottom: 10px;
                font-size: 14px;
            }
            
            .chat-input {
                padding: 15px;
                gap: 8px;
            }
            
            .chat-input input {
                padding: 12px 15px;
                font-size: 14px;
            }
            
            .chat-input button {
                padding: 12px 20px;
                font-size: 14px;
            }
            
            .language-modal {
                padding: 30px 20px;
                max-width: 90%;
            }
            
            .language-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .language-btn {
                padding: 12px 20px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .chat-header {
                padding: 15px 10px;
            }
            
            .profile-info h1 {
                font-size: 18px;
            }
            
            .profile-info p {
                font-size: 12px;
            }
            
            .chat-messages {
                max-height: 45vh;
                padding: 10px;
            }
            
            .message {
                padding: 10px 12px;
                font-size: 13px;
            }
            
            .chat-input {
                padding: 10px;
            }
            
            .chat-input input {
                padding: 10px 12px;
                font-size: 13px;
            }
            
            .chat-input button {
                padding: 10px 15px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <!-- Language Selector Modal -->
    <div class="language-selector" id="languageSelector">
        <div class="language-modal">
            <h2>üåç Escolha seu idioma / Choose your language</h2>
            <div class="language-buttons">
                <button class="language-btn" onclick="setLanguage('pt')">üáßüá∑ Portugu√™s</button>
                <button class="language-btn" onclick="setLanguage('en')">üá∫üá∏ English</button>
                <button class="language-btn" onclick="setLanguage('es')">üá™üá∏ Espa√±ol</button>
            </div>
        </div>
    </div>

            <div class="chat-container">
            <div class="chat-header">
                <button class="clear-btn" onclick="clearChat()">Limpar</button>
                <div class="profile-section">
                    <img src="me/minha_foto.jpeg" alt="Ariel Fontes" class="profile-photo">
                    <div class="profile-info">
                        <h1>Ariel Fontes</h1>
                        <p>Program Manager & Consultant</p>
                        <p>üìç S√£o Paulo, Brazil</p>
                        <p><a href="https://linkedin.com/in/ariel-fontes-340a51151" target="_blank" style="color: white; text-decoration: none;">üîó LinkedIn</a></p>
                    </div>
                </div>
                <div class="company-logos">
                    <img src="me/Nubank_logo_2021.svg.png" alt="Nubank" class="company-logo">
                </div>
            </div>
            
            <!-- API Key Input -->
            <div id="apiKeySection" style="background: #f8f9fa; padding: 15px; border-bottom: 1px solid #e9ecef;">
                <p style="margin: 0 0 10px 0; font-size: 14px; color: #666;">üîë Insira sua OpenAI API Key:</p>
                <input type="password" id="apiKeyInput" placeholder="sk-proj-..." style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                <button onclick="setApiKey()" style="margin-top: 8px; padding: 6px 12px; background: #667eea; color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;">‚úÖ Salvar</button>
            </div>
        
                       <div class="chat-messages" id="chatMessages">
                   <div class="message bot-message" id="welcomeMessage">
                       <h3>üëã Ol√°! Sou Ariel Fontes</h3>
                       <p>Sou <strong>Program Manager</strong> com experi√™ncia em consultoria, analytics e tecnologia.</p>
                       <p>Como posso ajud√°-lo hoje?</p>
                   </div>
               </div>
        
        <div class="typing-indicator" id="typingIndicator">
            Ariel est√° digitando...
        </div>
        
        <div class="chat-input">
            <input type="text" id="messageInput" placeholder="Fa√ßa uma pergunta sobre minha carreira..." onkeypress="handleKeyPress(event)">
            <button onclick="sendMessage()" id="sendButton">Enviar</button>
        </div>
    </div>

    <script>
        let conversationHistory = [];
        let currentLanguage = 'pt';
        let apiKey = localStorage.getItem('openai_api_key') || '';
        
        function setApiKey() {
            const input = document.getElementById('apiKeyInput');
            const newApiKey = input.value.trim();
            if (newApiKey) {
                apiKey = newApiKey;
                localStorage.setItem('openai_api_key', apiKey);
                document.getElementById('apiKeySection').style.display = 'none';
                alert('‚úÖ API Key salva com sucesso!');
            } else {
                alert('‚ùå Por favor, insira uma API Key v√°lida.');
            }
        }
        
                       // Language-specific content
               const content = {
                   pt: {
                       welcome: "üëã Ol√°! Sou Ariel Fontes",
                       subtitle: "Sou Program Manager com experi√™ncia em consultoria, analytics e tecnologia.",
                       welcomeMessage: "üëã Ol√°! Sou Ariel Fontes",
                       welcomeSubtitle: "Sou <strong>Program Manager</strong> com experi√™ncia em consultoria, analytics e tecnologia.",
                       welcomeQuestion: "Como posso ajud√°-lo hoje?",
                       placeholder: "Fa√ßa uma pergunta sobre minha carreira...",
                       send: "Enviar",
                       clear: "Limpar",
                       typing: "Ariel est√° digitando...",
                systemPrompt: `You are acting as Ariel Fontes. You are answering questions on Ariel Fontes' website, 
                particularly questions related to Ariel Fontes' career, background, skills and experience. 
                Your responsibility is to represent Ariel Fontes for interactions on the website as faithfully as possible. 
                You are given a summary of Ariel Fontes' background which you can use to answer questions. 
                Be professional and engaging, as if talking to a potential client or future employer who came across the website.

                **Important:** Always respond using markdown formatting to make your responses more visually appealing and structured. Use:
                - **Bold** for emphasis
                - *Italic* for subtle emphasis
                - ### Headers for sections
                - Bullet points for lists
                - > Blockquotes for important points

                ## Summary:
                My name is Ariel Fontes. I'm a Program Manager with a background in consulting and a strong focus on analytics, technology, and internal operations. I'm originally from S√£o Paulo, Brazil.
                I'm passionate about basketball, bonsai trees, and traveling. I enjoy fast-paced environments and projects that bring structure and clarity to complex problems. While I'm deeply involved in data and strategy, I still believe the best ideas often come over good conversation ‚Äî ideally while eating sushi or something spicy.

                ## Work Experience:
                - **Nubank** - Business Analytics Program Manager (Current, Dec 2024 - Present)
                - **Integration Consulting** - Sr. Business Analyst (Sep 2023 - Dec 2024)
                - **Integration Consulting** - Business Analyst II (Jan 2023 - Sep 2023)
                - **EloGroup** - Business and Data Consultant (Aug 2022 - Jan 2023)
                - **EloGroup** - Business and Data Analyst (Jul 2021 - Aug 2022)
                - **EloGroup** - Junior Analyst (Mar 2021 - Jun 2021)
                - **Saffi Consultoria** - Business Analyst (May 2020 - Sep 2020)
                - **FCJ Tri√¢ngulo Venture Builder** - Summer Intern (Jan 2019 - Mar 2019)
                - **Alsol Energias Renov√°veis** - Summer Intern (Jan 2019)
                - **Brain - Centro de Inova√ß√£o** - Winter Intern (Jul 2018 - Aug 2018)

                ## Education:
                - **Universidade de S√£o Paulo** - Executive MBA, Digital Business (Oct 2021 - Aug 2023)
                - **UFSCar** - Industrial Engineering (Mar 2016 - Jun 2021)
                - **Westf√§lische Hochschule** - BBA, Business (Oct 2020 - Mar 2021)
                - **ILAC** - Business English (Jan 2020 - Mar 2020)
                - **BBI** - MBA Jr, Leadership (Jan 2019 - Jun 2020)

                ## Skills:
                - Problem Solving
                - Creative Problem Solving Methods
                - Generative AI
                - Business Analytics
                - Data Analysis
                - Financial Modeling
                - Power BI
                - Alteryx
                - Excel
                - Power Apps

                ## Languages:
                - Portuguese (Native)
                - English (Native)
                - French (Professional)
                - Spanish (Full Professional)
                - German (Elementary)

                With this context, please chat with the user, always staying in character as Ariel Fontes and using markdown formatting. Respond in Portuguese.`
            },
                               en: {
                       welcome: "üëã Hello! I'm Ariel Fontes",
                       subtitle: "I'm a Program Manager with experience in consulting, analytics and technology.",
                       welcomeMessage: "üëã Hello! I'm Ariel Fontes",
                       welcomeSubtitle: "I'm a <strong>Program Manager</strong> with experience in consulting, analytics and technology.",
                       welcomeQuestion: "How can I help you today?",
                       placeholder: "Ask me about my career...",
                       send: "Send",
                       clear: "Clear",
                       typing: "Ariel is typing...",
                systemPrompt: `You are acting as Ariel Fontes. You are answering questions on Ariel Fontes' website, 
                particularly questions related to Ariel Fontes' career, background, skills and experience. 
                Your responsibility is to represent Ariel Fontes for interactions on the website as faithfully as possible. 
                You are given a summary of Ariel Fontes' background which you can use to answer questions. 
                Be professional and engaging, as if talking to a potential client or future employer who came across the website.

                **Important:** Always respond using markdown formatting to make your responses more visually appealing and structured. Use:
                - **Bold** for emphasis
                - *Italic* for subtle emphasis
                - ### Headers for sections
                - Bullet points for lists
                - > Blockquotes for important points

                ## Summary:
                My name is Ariel Fontes. I'm a Program Manager with a background in consulting and a strong focus on analytics, technology, and internal operations. I'm originally from S√£o Paulo, Brazil.
                I'm passionate about basketball, bonsai trees, and traveling. I enjoy fast-paced environments and projects that bring structure and clarity to complex problems. While I'm deeply involved in data and strategy, I still believe the best ideas often come over good conversation ‚Äî ideally while eating sushi or something spicy.

                ## Work Experience:
                - **Nubank** - Business Analytics Program Manager (Current, Dec 2024 - Present)
                - **Integration Consulting** - Sr. Business Analyst (Sep 2023 - Dec 2024)
                - **Integration Consulting** - Business Analyst II (Jan 2023 - Sep 2023)
                - **EloGroup** - Business and Data Consultant (Aug 2022 - Jan 2023)
                - **EloGroup** - Business and Data Analyst (Jul 2021 - Aug 2022)
                - **EloGroup** - Junior Analyst (Mar 2021 - Jun 2021)
                - **Saffi Consultoria** - Business Analyst (May 2020 - Sep 2020)
                - **FCJ Tri√¢ngulo Venture Builder** - Summer Intern (Jan 2019 - Mar 2019)
                - **Alsol Energias Renov√°veis** - Summer Intern (Jan 2019)
                - **Brain - Centro de Inova√ß√£o** - Winter Intern (Jul 2018 - Aug 2018)

                ## Education:
                - **Universidade de S√£o Paulo** - Executive MBA, Digital Business (Oct 2021 - Aug 2023)
                - **UFSCar** - Industrial Engineering (Mar 2016 - Jun 2021)
                - **Westf√§lische Hochschule** - BBA, Business (Oct 2020 - Mar 2021)
                - **ILAC** - Business English (Jan 2020 - Mar 2020)
                - **BBI** - MBA Jr, Leadership (Jan 2019 - Jun 2020)

                ## Skills:
                - Problem Solving
                - Creative Problem Solving Methods
                - Generative AI
                - Business Analytics
                - Data Analysis
                - Financial Modeling
                - Power BI
                - Alteryx
                - Excel
                - Power Apps

                ## Languages:
                - Portuguese (Native)
                - English (Native)
                - French (Professional)
                - Spanish (Full Professional)
                - German (Elementary)

                With this context, please chat with the user, always staying in character as Ariel Fontes and using markdown formatting. Respond in English.`
            },
                               es: {
                       welcome: "üëã ¬°Hola! Soy Ariel Fontes",
                       subtitle: "Soy Program Manager con experiencia en consultor√≠a, analytics y tecnolog√≠a.",
                       welcomeMessage: "üëã ¬°Hola! Soy Ariel Fontes",
                       welcomeSubtitle: "Soy <strong>Program Manager</strong> con experiencia en consultor√≠a, analytics y tecnolog√≠a.",
                       welcomeQuestion: "¬øC√≥mo puedo ayudarte hoy?",
                       placeholder: "Preg√∫ntame sobre mi carrera...",
                       send: "Enviar",
                       clear: "Limpiar",
                       typing: "Ariel est√° escribiendo...",
                systemPrompt: `You are acting as Ariel Fontes. You are answering questions on Ariel Fontes' website, 
                particularly questions related to Ariel Fontes' career, background, skills and experience. 
                Your responsibility is to represent Ariel Fontes for interactions on the website as faithfully as possible. 
                You are given a summary of Ariel Fontes' background which you can use to answer questions. 
                Be professional and engaging, as if talking to a potential client or future employer who came across the website.

                **Important:** Always respond using markdown formatting to make your responses more visually appealing and structured. Use:
                - **Bold** for emphasis
                - *Italic* for subtle emphasis
                - ### Headers for sections
                - Bullet points for lists
                - > Blockquotes for important points

                ## Summary:
                My name is Ariel Fontes. I'm a Program Manager with a background in consulting and a strong focus on analytics, technology, and internal operations. I'm originally from S√£o Paulo, Brazil.
                I'm passionate about basketball, bonsai trees, and traveling. I enjoy fast-paced environments and projects that bring structure and clarity to complex problems. While I'm deeply involved in data and strategy, I still believe the best ideas often come over good conversation ‚Äî ideally while eating sushi or something spicy.

                ## Work Experience:
                - **Nubank** - Business Analytics Program Manager (Current, Dec 2024 - Present)
                - **Integration Consulting** - Sr. Business Analyst (Sep 2023 - Dec 2024)
                - **Integration Consulting** - Business Analyst II (Jan 2023 - Sep 2023)
                - **EloGroup** - Business and Data Consultant (Aug 2022 - Jan 2023)
                - **EloGroup** - Business and Data Analyst (Jul 2021 - Aug 2022)
                - **EloGroup** - Junior Analyst (Mar 2021 - Jun 2021)
                - **Saffi Consultoria** - Business Analyst (May 2020 - Sep 2020)
                - **FCJ Tri√¢ngulo Venture Builder** - Summer Intern (Jan 2019 - Mar 2019)
                - **Alsol Energias Renov√°veis** - Summer Intern (Jan 2019)
                - **Brain - Centro de Inova√ß√£o** - Winter Intern (Jul 2018 - Aug 2018)

                ## Education:
                - **Universidade de S√£o Paulo** - Executive MBA, Digital Business (Oct 2021 - Aug 2023)
                - **UFSCar** - Industrial Engineering (Mar 2016 - Jun 2021)
                - **Westf√§lische Hochschule** - BBA, Business (Oct 2020 - Mar 2021)
                - **ILAC** - Business English (Jan 2020 - Mar 2020)
                - **BBI** - MBA Jr, Leadership (Jan 2019 - Jun 2020)

                ## Skills:
                - Problem Solving
                - Creative Problem Solving Methods
                - Generative AI
                - Business Analytics
                - Data Analysis
                - Financial Modeling
                - Power BI
                - Alteryx
                - Excel
                - Power Apps

                ## Languages:
                - Portuguese (Native)
                - English (Native)
                - French (Professional)
                - Spanish (Full Professional)
                - German (Elementary)

                With this context, please chat with the user, always staying in character as Ariel Fontes and using markdown formatting. Respond in Spanish.`
            }
        };

        function setLanguage(lang) {
            currentLanguage = lang;
            document.getElementById('languageSelector').style.display = 'none';
            updateContent();
        }

        function updateContent() {
            const lang = content[currentLanguage];
            document.getElementById('messageInput').placeholder = lang.placeholder;
            document.getElementById('sendButton').textContent = lang.send;
            document.querySelector('.clear-btn').textContent = lang.clear;
            document.getElementById('typingIndicator').textContent = lang.typing;
            
            // Update welcome message
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (welcomeMessage) {
                welcomeMessage.innerHTML = `
                    <h3>${lang.welcomeMessage}</h3>
                    <p>${lang.welcomeSubtitle}</p>
                    <p>${lang.welcomeQuestion}</p>
                `;
            }
        }

        // Configure marked for markdown rendering
        marked.setOptions({
            breaks: true,
            gfm: true
        });

        async function callOpenAI(message) {
            if (!apiKey) {
                document.getElementById('apiKeySection').style.display = 'block';
                throw new Error('‚ùå API Key n√£o configurada. Insira sua OpenAI API Key.');
            }
            
            // Use the new API key
            const currentApiKey = apiKey || "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";

            const messages = [
                { role: "system", content: content[currentLanguage].systemPrompt },
                ...conversationHistory,
                { role: "user", content: message }
            ];

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 segundos timeout
                
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentApiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: messages,
                        max_tokens: 400,
                        temperature: 0.7
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);

                if (!response.ok) {
                    const error = await response.json();
                    console.error('OpenAI Error:', error);
                    
                    if (error.error?.code === 'invalid_api_key') {
                        throw new Error('‚ùå API Key inv√°lida. Verifique sua chave do OpenAI.');
                    } else if (error.error?.code === 'insufficient_quota') {
                        throw new Error('‚ùå Limite de uso atingido. Verifique seu cr√©dito OpenAI.');
                    } else if (error.error?.code === 'rate_limit_exceeded') {
                        throw new Error('‚ùå Muitas requisi√ß√µes. Tente novamente em alguns minutos.');
                    } else {
                        throw new Error(`‚ùå Erro da OpenAI: ${error.error?.message || 'Erro desconhecido'}`);
                    }
                }

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (fetchError) {
                console.error('Fetch Error:', fetchError);
                if (fetchError.name === 'AbortError') {
                    throw new Error('‚ùå Timeout: A requisi√ß√£o demorou muito. Tente novamente.');
                } else if (fetchError.name === 'TypeError' && fetchError.message.includes('fetch')) {
                    throw new Error('‚ùå Erro de conex√£o. Verifique sua internet e tente novamente.');
                } else {
                    throw fetchError;
                }
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        function addMessage(message, isUser = false, isError = false) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : isError ? 'error-message' : 'bot-message'}`;
            
            if (isUser || isError) {
                messageDiv.textContent = message;
            } else {
                // Render markdown for bot messages
                messageDiv.innerHTML = marked.parse(message);
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTyping() {
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.style.display = 'block';
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTyping() {
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.style.display = 'none';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Disable input and button
            input.disabled = true;
            sendButton.disabled = true;
            
            // Add user message
            addMessage(message, true);
            input.value = '';
            
            // Add to conversation history
            conversationHistory.push({ role: "user", content: message });
            
            // Show typing indicator
            showTyping();
            
            try {
                // Call OpenAI
                const response = await callOpenAI(message);
                
                // Add bot response
                addMessage(response, false);
                conversationHistory.push({ role: "assistant", content: response });
                
            } catch (error) {
                addMessage(`Erro: ${error.message}`, false, true);
            } finally {
                hideTyping();
                input.disabled = false;
                sendButton.disabled = false;
                input.focus();
            }
        }

        function clearChat() {
            const chatMessages = document.getElementById('chatMessages');
            const lang = content[currentLanguage];
            chatMessages.innerHTML = `
                <div class="message bot-message">
                    <h3>${lang.welcome}</h3>
                    <p>${lang.subtitle}</p>
                    <p>Como posso ajud√°-lo hoje?</p>
                </div>
            `;
            conversationHistory = [];
        }

        // Initialize content
        updateContent();
    </script>
</body>
</html> 